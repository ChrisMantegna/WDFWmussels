# Extra stuff that I used to check







#plot analytes by sites
```{r}
library(ggplot2)
library(gridExtra)

p450<- ggplot(allr, aes(x = site_name, y = p450)) +
  geom_point(color = "blue") +  # Scatter plot with blue color
  labs(x = "Sites", y = "p450 Values", title = "p450 Values by Site") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

SumPAHsHMW<- ggplot(allr, aes(x = site_name, y = SumPAHsHMW)) +
  geom_point(color = "red") +  # Scatter plot with blue color
  labs(x = "Sites", y = "Analyte Values", title = "SumPAHsHMW Values by Site") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Arrange the plots side by side
combined_plots <- grid.arrange(p450, SumPAHsHMW, ncol = 2,
                               widths = c(8, 8)) 
```
```{r}
SumPAHsHMW<- ggplot(allr, aes(x = site_name, y = SumPAHsHMW)) +
  geom_point(color = "red") +  # Scatter plot with blue color
  labs(x = "Sites", y = "Analyte Values", title = "SumPAHsHMW Values by Site") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Arrange the plots side by side
combined_plots <- grid.arrange(p450, SumPAHsHMW, ncol = 2,
                               widths = c(8, 8)) 
```

```{r}
acenaphthene<- ggplot(allr, aes(x = site_name, y = acenaphthene)) +
  geom_point(color = "red") +  # Scatter plot with blue color
  labs(x = "Sites", y = "Analyte Values", title = "acenaphthene Values by Site") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Arrange the plots side by side
combined_plots <- grid.arrange(p450, acenaphthene, ncol = 2,
                               widths=c(8,8))
```


```{r}
anthracene<- ggplot(allr, aes(x = site_name, y = anthracene)) +
  geom_point(color = "red") +  # Scatter plot with blue color
  labs(x = "Sites", y = "Analyte Values", title = "anthracene Values by Site") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Arrange the plots side by side
combined_plots <- grid.arrange(p450, anthracene, ncol = 2,
                               widths = c(8, 8)) 
```

```{r}
# Load the ggplot2 package
library(ggplot2)

# Assuming your data frame is named 'allr'
Biomarker <- allr[[4]]  # Biomarker column

# Loop through columns 4 to 54
for (i in 9:54) {
    # Create a temporary data frame for plotting
    temp_data <- data.frame(Biomarker = p450, Value = allr[[i]])

    # Generate the plot
    p <- ggplot(temp_data, aes(x = Value, y = Biomarker)) +
        geom_point() +  # Add points
        geom_smooth(method = "lm", se = FALSE) +  # Add a linear regression line without standard error
        labs(title = paste("Biomarker vs", colnames(allr)[i]),
             x = "Biomarker",
             y = colnames(allr)[i])

    # Print the plot
    print(p)
}

```

```{r}
# Load the ggplot2 package
library(ggplot2)
getwd()
plot_directory<- "/Users/cmantegna/Documents/WDFWmussels/output/individual_plots/"


Sites <- allr[[1]]  # Site name column

# Loop through columns 5 to 58 (or whatever your range is)
for (i in 5:58) {
    # Create a temporary data frame for plotting
    temp_data <- data.frame(Sites = Sites, Value = allr[[i]])

    # Generate the plot
    s <- ggplot(temp_data, aes(x = Sites, y = Value)) +
        geom_point() +  
        geom_smooth(method = "lm", se = FALSE) +  # Add a linear regression line without standard error
        labs(title = paste("Site vs", colnames(allr)[i]),
             x = "Site Name",
             y = colnames(allr)[i])+
      theme(axis.text.x = element_text(angle = 90, hjust = 1))

    # Print the plot
    print(s)
}

# Define the file name
    #file_name <- paste0("/Site_vs_", colnames(allr)[i], ".png")

#ggsave(file_name, plot= s, width=10, height=6)

```

# 0's and negative number management

SOD values that are negative are changed to 0 signifying that the value was undetectable.\
p450 values that are 0 are missing, not actual 0's.


# this code isn't correct for alldata - need to fix
# Detect outliers and plot them - code a combo of stack overflow and chat gpt.

```{r}

detect_outliers_mad <- function(alldata, accuracy = 0.99) {
  # Calculate z-score equivalent for the given accuracy
  z_threshold <- qnorm(accuracy + (1 - accuracy) / 2)

  # Initialize a list to store outlier indices for each numeric column
  outliers_list <- list()

  # Initialize a vector to keep track of rows with outliers
  rows_with_outliers <- rep(FALSE, nrow(alldata))

  # Loop through each column in the dataframe
  for (col_name in names(data)) {
    # Check if the column is numeric
    if (is.numeric(data[[col_name]])) {
      # Calculate MAD and median for the column
      mad_value <- median(abs(data[[col_name]] - median(data[[col_name]])))
      median_value <- median(data[[col_name]])

      # Calculate the deviation scores (using a modified z-score formula)
      deviation_scores <- 0.6745 * (data[[col_name]] - median_value) / mad_value

      # Identify indices of outliers
      outlier_indices <- which(abs(deviation_scores) > z_threshold)

      # Store the indices in the list
      outliers_list[[col_name]] <- outlier_indices

      # Update rows with outliers
      rows_with_outliers[outlier_indices] <- TRUE
    }
  }

  # Return the list of outliers and rows with outliers
  list(outliers_list = outliers_list, rows_with_outliers = rows_with_outliers)
}

outliers_info <- detect_outliers_mad(alldata)

# Convert the list of outliers to a named vector of counts
num_outliers_each_col <- sapply(outliers_info$outliers_list, length)
num_rows_with_outliers <- sum(outliers_info$rows_with_outliers)

# Check if there are any outliers
if (all(num_outliers_each_col == 0)) {
  print("There are no outliers in any columns.")
} else {
  # Create a data frame for plotting
  outliers_data_df <- data.frame(
    Column = names(num_outliers_each_col),
    Outliers = as.integer(num_outliers_each_col),
    OutlierPercentage = (as.integer(num_outliers_each_col) / nrow(data)) * 100
  )

  # Plot the number of outliers for all columns
  outlier_plot <- ggplot(outliers_data_df, aes(x = Column, y = Outliers, fill = Column)) +
    geom_bar(stat = "identity") +
    geom_text(aes(label = sprintf("%.2f%%", OutlierPercentage)), position = position_dodge(width = 0.9), vjust = -0.25) +
    coord_flip() +
    labs(title = "Number of Outliers by Column", x = "Column", y = "Number of Outliers") +
    scale_fill_brewer(palette = "Set3") +
    theme_minimal()

  print(outlier_plot)
}

#ggsave(plot= outlier_plot, filename="/Users/cmantegna/Documents/WDFWmussels/output/outliers.png", width=15, height=8)

```

# Plotting both biomarkers in a box plot

```{r}

all<-plot<- ggplot(alldata) +
  geom_point(aes(x = site_name, y = SOD, color = "SOD")) +
  geom_point(aes(x = site_name, y = p450, color = "P450")) +
  labs(x = "Site Name", y = "Value", color = "Biomarker") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


print(all)
ggsave(plot=all, filename="/Users/cmantegna/Documents/WDFWmussels/output/allBoxPlot.png", width=15, height=8)

```

# Plotting both biomarkers in a box plot with a free y-axis to fix the sod v p450 values. The SOD values all look the same and are all at 0.

Note that the color for SOD shifts from teal to salmon between the two plots.

```{r}
# First, create a basic ggplot object with SOD data
freey <- ggplot(data, aes(x = site_name)) +
  geom_point(aes(y = SOD, color = "SOD")) +
  labs(x = "Site Name", y = "SOD Value") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Then, add p450 using sec.axis
freey + geom_point(aes(y = p450/100, color = "p450")) + # Example scaling factor, adjust as needed
  scale_y_continuous(sec.axis = sec_axis(~.*100, name = "p450 Value")) # Reverse the scaling for the secondary axis label

print(freey)
#ggsave(plot=freey, filename="/Users/cmantegna/Documents/WDFWmussels/output/allBoxPlotFreeY.png", width=15, height=8)
```

# Plotting both biomarkers in their own box plots with a facet wrap to try to show the difference in values for both biomarkers since SOD looks the same.

```{r}

# Reshape data from wide to long format
long_data <- pivot_longer(data, cols = c(SOD, p450), names_to = "Biomarker", values_to = "Value")

# Plotting with faceting
facetp <- ggplot(long_data, aes(x = site_name, y = Value, color = Biomarker)) +
  geom_point() +
  facet_wrap(~Biomarker, scales = "free_y") + # This allows each biomarker to have its own y-axis scale
  labs(x = "Site Name", y = "Value", color = "Biomarker") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

print(facetp)
# Save the plot
ggsave(plot=facetp, filename="/Users/cmantegna/Documents/WDFWmussels/output/allBoxPlotFacet.png", width=15, height=8)

```

# Plotting separate box plots to investigate the facet, the other options still show the sod values the 'same' when everything is plotted together.

```{r}

# Ensure your data is in the correct format.
# Reshape your dataframe if it hasn't been done correctly.
long_data <- pivot_longer(data, cols = c(SOD, p450), names_to = "Biomarker", values_to = "Value")

# Faceted plot with separate scales.
plotf<- ggplot(long_data, aes(x = site_name, y = Value)) +
  geom_point(aes(color = Biomarker)) +
  facet_wrap(~ Biomarker, scales = "free_y") +
  labs(x = "Site Name", y = "Value", color = "Biomarker") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

print(plotf)
ggsave(plot=plotf, filename="/Users/cmantegna/Documents/WDFWmussels/output/allBoxPlotFacetPanels.png", width=40, height=25)

```

# Plotting p450 values ranked from smallest to largest

```{r}

# Order the sites by p450 value
data_ordered <- data[order(data$p450),]

# Create a factor with the ordered site names
data_ordered$site_name <- factor(data_ordered$site_name, levels = unique(data_ordered$site_name))

# Plot the SOD values in a boxplot with ordered site names
rankp<- ggplot(data_ordered, aes(x = site_name, y = p450)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) # Rotate x labels if needed

print(rankp)
ggsave(plot=rankp, filename="/Users/cmantegna/Documents/WDFWmussels/output/p450ranked.png", width=15, height=8)
```

# Plotting SOD values ranked from samllest largest

```{r}

# Order the sites by p450 value
data_ordered <- data[order(data$SOD),]

# Create a factor with the ordered site names
data_ordered$site_name <- factor(data_ordered$site_name, levels = unique(data_ordered$site_name))

# Plot the SOD values in a boxplot with ordered site names
ranks<- ggplot(data_ordered, aes(x = site_name, y = SOD)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) # Rotate x labels if needed

print(ranks)
ggsave(plot=ranks, filename="/Users/cmantegna/Documents/WDFWmussels/output/SODranked.png", width=15, height=8)
```

