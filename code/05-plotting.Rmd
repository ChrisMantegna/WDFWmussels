---
title: "05- Box Plots of All Metrics by Groupings"
output:
  pdf_document: 
    fig_width: 20
    fig_height: 9
  html_document: 
    toc: true
    toc_float:
        collapsed: false
        smooth_scroll: true
    fig_width: 20
---

# Directory and doc rules

```{r, setup, eval=TRUE, include=TRUE}

knitr::opts_chunk$set(
  root.dir = here::here(),
  echo = TRUE,         # Display code chunks
  eval = TRUE,         # Evaluate code chunks
  warning = FALSE,     # Hide warnings
  message = FALSE,     # Hide messages
  #fig.width = 15,       # Set plot width in inches
  #fig.height = 11,      # Set plot height in inches
  fig.align = "center" # Align plots to the center
)

```

# Load & Check Data
```{r}

# double check where you are
# *NOTE* see 00-data_cleaned for directory issue
getwd()

# load data
# complete df
data<- read.csv("../data/cleaned/avg_all_analytes_individual.csv")
hch<- read.csv("../data/cleaned/avg_all_chlordanesHch.csv")
pest<-read.csv("../data/cleaned/avg_all_ddtPesticide.csv")
hmw<- read.csv("../data/cleaned/avg_all_hmw.csv")
lmw<- read.csv("../data/cleaned/avg_all_lmw.csv")
metal<- read.csv("../data/cleaned/avg_all_metal.csv")
pbde<- read.csv("../data/cleaned/avg_all_pbde.csv")
pcb<- read.csv("../data/cleaned/avg_all_pcb.csv")
summed<- read.csv("../data/cleaned/avg_all_summed.csv")

# check it out
#str(data) # checking df structure
# note that sample_id and site_number are integers and may need to be adjusted to characters for analysis

#summary(data) #checking df contents

#colnames(data) <- tolower(colnames(data)) # if needed

```

# Box Plots by Grouping
```{r}

# Load required libraries
library(ggplot2)
library(patchwork)  # For arranging plots in a grid
library(dplyr)

# Ensure categorical group columns are factors
groups <- c("reporting_area", "geo_group", "pah_group", "pcb_group")
data <- data %>% mutate(across(all_of(groups), as.factor))

# Identify the metric columns dynamically
metrics_of_interest <- colnames(data)[9:14]  # Adjust if necessary

# Loop through each metric
for (metric in metrics_of_interest) {
  
  # List to store individual plots
  plot_list <- list()
  
  # Loop through each categorical group
  for (group in groups) {
    
    # Generate boxplot
    p <- ggplot(data, aes_string(x = group, y = metric)) +
      geom_boxplot(fill = "lightblue", color = "black") +
      labs(
        title = paste("Plot of", metric, "by", group),
        x = group,
        y = metric
      ) +
      theme_minimal() +  # Remove default grid
      theme(
        plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # Centered title
        axis.title = element_text(size = 14, face = "bold"),  # Larger axis labels
        axis.text = element_text(size = 12),  # Adjust tick labels
        axis.line = element_line(size = 1, color = "black"),  # Bold major axes
        panel.grid.major = element_blank(),  # Remove major grid
        panel.grid.minor = element_blank()   # Remove minor grid
      )
    
    # Store the plot
    plot_list[[group]] <- p
  }
  
  # Arrange plots in a 2x2 grid
  final_plot <- (plot_list[[groups[1]]] | plot_list[[groups[2]]]) /
                (plot_list[[groups[3]]] | plot_list[[groups[4]]])
  
  # Save the final plot
  plot_filename <- paste0("/Users/cmantegna/Documents/GitHub/WDFWmussels/output/", metric, "_boxplots_grid.png")
  ggsave(plot_filename, final_plot, width = 12, height = 10, dpi = 300)
  
  # Print the plot in R
  print(final_plot)
}


```

# Scatter Plots by Grouping
```{r}

# Load required libraries
library(ggplot2)
library(dplyr)

# List of datasets and their corresponding analytes
datasets <- list(
  metal = list(data = metal, analytes = colnames(metal)[15:20]),  # Metal has 6 analytes
  summed = list(data = summed, analytes = colnames(summed)[15:25])  # Summed has 11 analytes
)

# Define metric columns dynamically (same structure in both datasets)
metrics_of_interest <- colnames(metal)[9:14]  # Adjust if necessary
groups <- c("reporting_area", "geo_group", "pah_group", "pcb_group")

# Create "output" directory if it doesn't exist
if (!dir.exists("output")) {
  dir.create("output")
}

# Loop through each dataset
for (dataset_name in names(datasets)) {
  
  dataset_info <- datasets[[dataset_name]]
  data <- dataset_info$data
  analyte_columns <- dataset_info$analytes
  
  # Ensure categorical group columns are factors
  data <- data %>% mutate(across(all_of(groups), as.factor))

  # Loop through each metric
  for (metric in metrics_of_interest) {
    
    # Loop through each analyte
    for (analyte in analyte_columns) {
      
      # Generate scatterplot
      p <- ggplot(data, aes_string(x = analyte, y = metric)) +
        geom_point(color = "blue", alpha = 0.6) +
        geom_smooth(method = "lm", color = "red", se = FALSE) +  # Trendline
        labs(
          title = paste(metric, "vs", analyte, "in", dataset_name),
          x = analyte,
          y = metric
        ) +
        theme_minimal() +  # Remove default grid
        theme(
          plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # Centered title
          axis.title = element_text(size = 14, face = "bold"),  # Larger axis labels
          axis.text = element_text(size = 12),  # Adjust tick labels
          axis.line = element_line(size = 1, color = "black"),  # Bold major axes
          panel.grid.major = element_blank(),  # Remove major grid
          panel.grid.minor = element_blank()   # Remove minor grid
        )
      
      # Save each scatterplot individually
      plot_filename <- paste0("/Users/cmantegna/Documents/GitHub/WDFWmussels/output/", dataset_name, "_", metric, "_vs_", analyte, ".png")
      ggsave(plot_filename, p, width = 8, height = 6, dpi = 300)
      
      # Print each plot (optional)
      print(p)
    }
  }
}


```


# Bow Plots by Grouping
```{r}

# Load required libraries
library(ggplot2)
library(dplyr)

# List of datasets and their groups
datasets <- list(
  metal = metal,
  summed = summed
)

# Define metric columns dynamically (same structure in both datasets)
metrics_of_interest <- colnames(metal)[9:14]  # Adjust if necessary
groups <- c("reporting_area", "geo_group", "pah_group", "pcb_group")

# Create "output" directory if it doesn't exist
if (!dir.exists("output")) {
  dir.create("output")
}

# Loop through each dataset
for (dataset_name in names(datasets)) {
  
  data <- datasets[[dataset_name]]
  
  # Ensure categorical group columns are factors
  data <- data %>% mutate(across(all_of(groups), as.factor))

  # Loop through each metric
  for (metric in metrics_of_interest) {
    
    # Loop through each categorical group
    for (group in groups) {
      
      # Generate boxplot
      p <- ggplot(data, aes_string(x = group, y = metric)) +
        geom_boxplot(fill = "lightblue", color = "black") +
        labs(
          title = paste("Distribution of", metric, "by", group, "in", dataset_name),
          x = group,
          y = metric
        ) +
        theme_minimal() +  # Remove default grid
        theme(
          plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # Centered title
          axis.title = element_text(size = 14, face = "bold"),  # Larger axis labels
          axis.text = element_text(size = 12),  # Adjust tick labels
          axis.line = element_line(size = 1, color = "black"),  # Bold major axes
          panel.grid.major = element_blank(),  # Remove major grid
          panel.grid.minor = element_blank()   # Remove minor grid
        )
      
      # Save the boxplot individually
      plot_filename <- paste0("/Users/cmantegna/Documents/GitHub/WDFWmussels/output/", dataset_name, "_", metric, "_boxplot_", group, ".png")
      ggsave(plot_filename, p, width = 8, height = 6, dpi = 300)
      
      # Print the plot (optional)
      print(p)
    }
  }
}


```

# Targeted Box Plots - metal + p450
```{r}

# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)

# Define the dataset and column names
metric_column <- "p450"  # Change to the actual metric name (e.g., "p450")
analyte_columns <- colnames(metal)[15:20]  # Select metal analytes dynamically
group_column <- "reporting_area"  # Grouping variable

# Ensure the grouping column is a factor
metal <- metal %>% mutate(across(all_of(group_column), as.factor))

# Reshape the data from wide to long format for ggplot
metal_long <- metal %>%
  select(all_of(c(group_column, metric_column, analyte_columns))) %>%
  pivot_longer(cols = all_of(analyte_columns), names_to = "Metal", values_to = "Metal_Concentration")

# Generate the grouped boxplot
p <- ggplot(metal_long, aes(x = .data[[group_column]], y = .data[[metric_column]], fill = Metal)) +
  geom_boxplot() +
  labs(
    title = paste("Distribution of", metric_column, "by", group_column, "with Metals"),
    x = group_column,
    y = metric_column,
    fill = "Metal Type"
  ) +
  theme_minimal() +  # Remove default grid
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # Centered title
    axis.title = element_text(size = 14, face = "bold"),  # Larger axis labels
    axis.text = element_text(size = 12),  # Adjust tick labels
    axis.line = element_line(size = 1, color = "black"),  # Bold major axes
    panel.grid.major = element_blank(),  # Remove major grid
    panel.grid.minor = element_blank()   # Remove minor grid
  )

# Save the plot
#plot_filename <- paste0("output/metal_", metric_column, "_boxplot_", group_column, ".png")
#ggsave(plot_filename, p, width = 10, height = 6, dpi = 300)

# Print the plot
print(p)


```

# sod
```{r}

# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)

# Define the dataset and column names
metric_column <- "sod"  # Change to the actual metric name (e.g., "p450")
analyte_columns <- colnames(metal)[15:20]  # Select metal analytes dynamically
group_column <- "reporting_area"  # Grouping variable

# Ensure the grouping column is a factor
metal <- metal %>% mutate(across(all_of(group_column), as.factor))

# Reshape the data from wide to long format for ggplot
metal_long <- metal %>%
  select(all_of(c(group_column, metric_column, analyte_columns))) %>%
  pivot_longer(cols = all_of(analyte_columns), names_to = "Metal", values_to = "Metal_Concentration")

# Generate the grouped boxplot
p <- ggplot(metal_long, aes(x = .data[[group_column]], y = .data[[metric_column]], fill = Metal)) +
  geom_boxplot() +
  labs(
    title = paste("Distribution of", metric_column, "by", group_column, "with Metals"),
    x = group_column,
    y = metric_column,
    fill = "Metal Type"
  ) +
  theme_minimal() +  # Remove default grid
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # Centered title
    axis.title = element_text(size = 14, face = "bold"),  # Larger axis labels
    axis.text = element_text(size = 12),  # Adjust tick labels
    axis.line = element_line(size = 1, color = "black"),  # Bold major axes
    panel.grid.major = element_blank(),  # Remove major grid
    panel.grid.minor = element_blank()   # Remove minor grid
  )

# Save the plot
#plot_filename <- paste0("output/metal_", metric_column, "_boxplot_", group_column, ".png")
#ggsave(plot_filename, p, width = 10, height = 6, dpi = 300)

# Print the plot
print(p)


```

# shell thickness
```{r}

# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)

# Define the dataset and column names
metric_column <- "shell_thickness"  # metric
analyte_columns <- colnames(metal)[15:20]  # Select metal analytes dynamically
group_column <- "reporting_area"  # Grouping variable

# Ensure the grouping column is a factor
metal <- metal %>% mutate(across(all_of(group_column), as.factor))

# Reshape the data from wide to long format for ggplot
metal_long <- metal %>%
  select(all_of(c(group_column, metric_column, analyte_columns))) %>%
  pivot_longer(cols = all_of(analyte_columns), names_to = "Metal", values_to = "Metal_Concentration")

# Generate the grouped boxplot
p <- ggplot(metal_long, aes(x = .data[[group_column]], y = .data[[metric_column]], fill = Metal)) +
  geom_boxplot() +
  labs(
    title = paste("Distribution of", metric_column, "by", group_column, "with Metals"),
    x = group_column,
    y = metric_column,
    fill = "Metal Type"
  ) +
  theme_minimal() +  # Remove default grid
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # Centered title
    axis.title = element_text(size = 14, face = "bold"),  # Larger axis labels
    axis.text = element_text(size = 12),  # Adjust tick labels
    axis.line = element_line(size = 1, color = "black"),  # Bold major axes
    panel.grid.major = element_blank(),  # Remove major grid
    panel.grid.minor = element_blank()   # Remove minor grid
  )

# Save the plot
#plot_filename <- paste0("output/metal_", metric_column, "_boxplot_", group_column, ".png")
#ggsave(plot_filename, p, width = 10, height = 6, dpi = 300)

# Print the plot
print(p)



```

