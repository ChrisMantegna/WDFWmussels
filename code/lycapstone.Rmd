---
title: "Ly's Capstone Data Visualization"
output:
  pdf_document: 
    fig_width: 20
    fig_height: 9
  html_document: 
    toc: true
    toc_float:
        collapsed: false
        smooth_scroll: true
    fig_width: 20
---

# Directory and doc rules

```{r, setup, eval=TRUE, include=TRUE}

knitr::opts_chunk$set(
  echo = TRUE,         # Display code chunks
  eval = TRUE,         # Evaluate code chunks
  warning = FALSE,     # Hide warnings
  message = FALSE,     # Hide messages
  fig.width = 20,       # Set plot width in inches
  fig.height = 9,      # Set plot height in inches
  fig.align = "center" # Align plots to the center
)

```

# Load packages

```{r}
library(tinytex)
library(tidyr)
library(tidyverse)
library(vegan)

```

# Load data

Weight = mg\
Length, width, height = mm\
p450, SOD = activity/ (mg/protein)\
Condition factor= unitless

```{r}
#this is important to know where you are working and where your outputs will land if you haven't set it up.
getwd()
#data has all sites, coordinates, p450, sod, condition factor, economic factor data
data<- read.csv("/Users/cmantegna/Documents/WDFWmussels/data/lycapstone.csv")

```

```{r}
#review your data. Summary lets you see the values and data ranges. Str lets you see the data class of each column, this is important if you are trying to perform numerical operations on data identified as non-numeric.
summary(data)
str(data)
```

```{r}
#remove any p450 values that are 0 - those are true 0's not non-detectable. I am replacing with na so I don't lose the entire row of data, including the SOD values.
data$p450[data$p450 <= 0] <- NA
1
```

# Boxplots
## p450 - these are non ranked from lowest to highest activity, all sites listed alphabetically.
```{r}

#plot with ordered site names
p450ly<- ggplot(data, aes(x = site_name, y = p450)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) # Rotate x labels if needed

print(p450ly)
#ggsave(plot=p450ly, filename="/Users/cmantegna/Documents/WDFWmussels/output/lycapstone/p450boxplot.png", width=20, height=9)
```

## p450 - these are ranked from lowest to highest activity.
```{r}

#order the sites by value
data_ordered <- data[order(data$p450),]

#create a factor with the ordered site names
data_ordered$site_name <- factor(data_ordered$site_name, levels = unique(data_ordered$site_name))

#plot with ordered site names
lyrankp<- ggplot(data_ordered, aes(x = site_name, y = p450)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) # Rotate x labels if needed

print(lyrankp)
#ggsave(plot=lyrankp, filename="/Users/cmantegna/Documents/WDFWmussels/output/lycapstone/p450boxplotranked.png", width=20, height=9)
```

## SOD - these are non ranked from lowest to highest activity, all sites listed alphabetically.
```{r}

#plot with ordered site names
sodly<- ggplot(data, aes(x = site_name, y = SOD)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) # Rotate x labels if needed

print(sodly)
#ggsave(plot=sodly, filename="/Users/cmantegna/Documents/WDFWmussels/output/lycapstone/sodboxplot.png", width=20, height=9)

```

## SOD - these are ranked from lowest to highest activity.
```{r}

#order the sites by value
data_ordered <- data[order(data$SOD),]

#create a factor with the ordered site names
data_ordered$site_name <- factor(data_ordered$site_name, levels = unique(data_ordered$site_name))

#plot with ordered site names
lyranks<- ggplot(data_ordered, aes(x = site_name, y = SOD)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) # Rotate x labels if needed

print(lyranks)
#ggsave(plot=lyrankp, filename="/Users/cmantegna/Documents/WDFWmussels/output/lycapstone/sodboxplotranked.png", width=20, height=9)

```

# Maps
## If you want to keep the full view of Washington state instead of the Puget Sound view we can do that easily.
```{r}
#base map of washington state
library(sf)
library(viridis)
library(rnaturalearth)
library(rnaturalearthdata)

world <- ne_states(country = "united states of america", returnclass = "sf")
washington_map <- world[world$name == "Washington", ]
```

## p450 - all sites (puget sound)
```{r}

#zoom into puget sound region & note the legend, lighter colors are higher values
xlim <- c(-124, -122)  # longitude bounds
ylim <- c(47, 49)  # latitude bounds

lyp450pugetsound<- ggplot() + 
  geom_sf(data = washington_map, fill = "lightgrey", color = "white") +
  geom_point(data = data, aes(x = longitude, y = latitude, color = p450), size = 3) +
  scale_color_viridis(option = "C", name = "p450") +
  coord_sf(xlim = xlim, ylim = ylim, expand = FALSE)+
  theme_minimal() +
  labs(title = "Puget Sound - P450 Values")

print(lyp450pugetsound)
#ggsave(plot=lyp450pugetsound, filename="/Users/cmantegna/Documents/WDFWmussels/output/lycapstone/lyp450pugetsound.png", width=20, height=9)

```

## SOD - all sites (puget sound)
```{r}

#zoom into puget sound region & note the legend, lighter colors are higher values
xlim <- c(-124, -122)  # longitude bounds
ylim <- c(47, 49)  # latitude bounds

lySODpugetsound<- ggplot() + 
  geom_sf(data = washington_map, fill = "lightgrey", color = "white") +
  geom_point(data = data, aes(x = longitude, y = latitude, color = SOD), size = 3) +
  scale_color_viridis(option = "C", name = "SOD") +
  coord_sf(xlim = xlim, ylim = ylim, expand = FALSE)+
  theme_minimal() +
  labs(title = "Puget Sound - SOD Values")

print(lySODpugetsound)
#ggsave(plot=lySODpugetsound, filename="/Users/cmantegna/Documents/WDFWmussels/output/lycapstone/lySODpugetsound.png", width=20, height=9)

```

