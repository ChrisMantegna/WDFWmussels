---
title: "02- SOD Data Exploration"
output:
  html_document: 
    toc: true
    toc_float:
        collapsed: false
        smooth_scroll: true
    fig_width: 20
  pdf_document: 
    fig_width: 20
    fig_height: 9
---

# Directory and doc rules

```{r, setup, eval=TRUE, include=TRUE}

knitr::opts_chunk$set(
  echo = TRUE,         # Display code chunks
  eval = TRUE,         # Evaluate code chunks
  warning = FALSE,     # Hide warnings
  message = FALSE,     # Hide messages
  fig.width = 20,       # Set plot width in inches
  fig.height = 9,      # Set plot height in inches
  fig.align = "center" # Align plots to the center
)

```

# Load packages

```{r}
library(tinytex)
library(tidyr)
library(tidyverse)
library(vegan)

```

# Load data

```{r}

getwd()
sdata<- read.csv("/Users/cmantegna/Documents/WDFWmussels/data/soddata.csv")

```

```{r}

# Data contains numbers below 0 that must be adjusted.These numbers represent samples whose values were below the limit of quantification using the SOD kit. There was some activity in the raw sample, but it is too far below the limit of the standard curve to be accurately quantified.


#replace any SOD values at or below 0 with half of the lower detection limit of .005 (.005*.5). Lower detection limit determined by assay protocol by the manufacturer, Cayman.
sdata$sod[sdata$sod <= 0] <- 0.0025

```
# Check data

```{r}
summary(sdata)
```

# Plot data - boxplot, all SOD values by site name

```{r}

#sod is in unit/ mg protein

splot<- ggplot(sdata, aes(x = site_name, y = sod)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) 

print(splot)

```

# Plot data - ranked box plot, all SOD values by site name
```{r}

#order the sites by value

data_ordered <- sdata[order(sdata$sod),]

#create a factor with the ordered site names
data_ordered$site_name <- factor(data_ordered$site_name, levels = unique(data_ordered$site_name))

#plot with ordered site names
ranked<- ggplot(data_ordered, aes(x = site_name, y = sod)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) # Rotate x labels if needed

print(ranked)
```

# *All analytes were plotted by site and reporting area in p450 flow.*

# Plot data - boxplot, all p450 values by reporting area
```{r}

sdata$reporting_area <- as.character(sdata$reporting_area)

#sod
splot<- ggplot(sdata, aes(x = reporting_area, y = sod)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) 

print(splot)

```

# Shapiro-Wilkes 
```{r}

#test for normality. Data is not normally distributed.
# *All analytes were plotted by site and reporting area in p450 flow.* 

shapiro.test(sdata$sod)

```

# Kruskal-Wallis

```{r}

#test for significant interaction

kruskal.test(sod ~ site_name, data = sdata)
kruskal.test(sod ~ reporting_area, data = sdata)

```

# Kruskal-Wallac Multiple Comparisons (post hoc)

Reporting Areas Are:
6 - East Juan de Fuca Strait
7 - San Juan Islands
8.1 - Deception Pass, Hope Island, and Skagit Bay
8.2 - Port Susan and Port Gardner
9 - Admiralty Inlet
10 - Seattle-Bremerton
11 - Tacoma-Vashon
12 - Hood Canal
13 - South Puget Sound

```{r}
library(pgirmess)

# no significance confirmed between sites
# no significance confirmed between reporting areas

mc_site<- as.data.frame(kruskalmc(sod ~ site_name, data = sdata, method = "bonferroni"))
mc_reporting<- as.data.frame(kruskalmc(sod ~ reporting_area, data = sdata, method = "bonferroni")) 

head(mc_site)
head(mc_reporting)

```

# Correlation test - SOD and SumPAH
```{r}

# no correlation
correlation_result <- cor.test(sdata$sod, sdata$sumPAH, method = "pearson")
print(correlation_result)
```

# Correlation test - SOD and hmwPAH
```{r}

# no correlation
correlation_result <- cor.test(sdata$sod, sdata$hmwPAH, method = "pearson")
print(correlation_result)
```

# Correlation test - SOD and SumPCB
```{r}

# correlation= 0.1557987 with a p-value of .0059. This is a significant weak correlation.

correlation_result <- cor.test(sdata$sod, sdata$sumPCB, method = "pearson")
print(correlation_result)
```

