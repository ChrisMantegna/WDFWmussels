---
title: "01- Data Exploration"
output:
  html_document:
    df_print: paged
  pdf_document: 
    fig_width: 20
    fig_height: 9
---

# Directory and doc rules

```{r, setup, eval=TRUE, include=TRUE}

knitr::opts_chunk$set(
  echo = TRUE,         # Display code chunks
  eval = TRUE,         # Evaluate code chunks
  warning = FALSE,     # Hide warnings
  message = FALSE,     # Hide messages
  fig.width = 20,       # Set plot width in inches
  fig.height = 9,      # Set plot height in inches
  fig.align = "center" # Align plots to the center
)

```

# Load packages

```{r}
library(tinytex)
library(tidyr)
library(tidyverse)
library(vegan)

```

# Load data
Weight = mg\
Length, width, height = mm\
p450, SOD = activity/ (mg/protein)\
Condition factor, economic factor = unitless
```{r}

getwd()
#data has all sites, coordinates, p450, sod, condition factor, economic factor data
data<- read.csv("/Users/cmantegna/Documents/WDFWmussels/data/biomarkerfull.csv")

#alldata has the site names, biomarkers, condition factor, average thickness and analyte data - each row is an individual sample
alldata<- read.csv("/Users/cmantegna/Documents/WDFWmussels/data/alldata.csv")

```

## fix zero's in the data frame and alldata frame

```{r}

# Data contains 0's and must be adjusted in this order to preserve all usable data.

#sod
#replace any SOD values at or below 0 with half of the lower detection limit of .005 (.005*.5). Lower detection limit determined by assay protocol by the manufacturer, Cayman.
data$SOD[data$SOD <= 0] <- 0.0025
alldata$SOD[alldata$SOD <= 0] <- 0.0025
#p450
#remove any p450 values that are 0 - those are true 0's not non-detectable. I am replacing with na so I don't lose the entire row of data, including the SOD values.
data$p450[data$p450 <= 0] <- NA
alldata$p450[alldata$p450 <= 0] <- NA

#write.csv(alldata, "/Users/cmantegna/Documents/WDFWmussels/data/alldata.csv")
```

```{r}
# check the data frame
#summary(alldata)
#str(alldata)
```

# Boxplot of biomarker data, p450 and SOD
```{r}
#p450
pplot<- ggplot(data, aes(x = site_name, y = p450)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) 

print(pplot)

#SOD
splot<- ggplot(data, aes(x = site_name, y = SOD)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) 

print(splot)
```


# Histograms of p450, SOD, condition_factor and avg_thickness 
### Only avg_thickness looks normally distributed.
```{r}
# p450 basic histogram + basic density plot
hist(alldata$p450)
plot(density(alldata$p450, na.rm= TRUE), main="Density Plot", xlab="p450 Value")

# SOD basic histogram + basic density plot
hist(alldata$SOD)
plot(density(alldata$SOD, na.rm= TRUE), main="Density Plot", xlab="p450 Value")

# Condition_factor basic histogram + basic density plot
hist(alldata$condition_factor)
plot(density(alldata$condition_factor, na.rm= TRUE), main="Density Plot", xlab="p450 Value")

# Avg_thickness basic histogram + basic density plot
hist(alldata$avg_thickness)
plot(density(alldata$avg_thickness, na.rm= TRUE), main="Density Plot", xlab="p450 Value")

```

# Shapiro-Wilkes test for normality
### Only avg_thickness is normally distributed.
```{r}
shapiro.test(alldata$p450)
shapiro.test(alldata$SOD)
shapiro.test(alldata$condition_factor)
shapiro.test(alldata$avg_thickness)

```

# Kruskal-Wallis, p450
### p450 and site have a statistically significant relationship, p< 0.0000008077
```{r}
kruskal.test(p450 ~ site_name, data = alldata)
kruskal.test(p450 ~ SOD, data = alldata)
kruskal.test(p450 ~ condition_factor, data = alldata)
kruskal.test(p450 ~ avg_thickness, data = alldata)

```

# Kruskal-Wallis, SOD
### SOD and site have a statistically significant relationship, p< 0.0000005669
```{r}
kruskal.test(SOD ~ site_name, data = alldata)
kruskal.test(SOD ~ p450, data = alldata)
kruskal.test(SOD ~ condition_factor, data = alldata)
kruskal.test(SOD ~ avg_thickness, data = alldata)

```

# Post hoc test. Kruskal-Wallac Multiple Comparisons
### p450 and site_name show no true differences despite K-W test result.
### SOD and site_name show a true site difference between Elliott Bay, Mrytle Edwards and Hood Canal only.
```{r}
library(pgirmess)

mc_p450<- as.data.frame(kruskalmc(p450 ~ site_name, data = alldata, method = "bonferroni"))
mc_SOD<- as.data.frame(kruskalmc(SOD ~ site_name, data = alldata, method = "bonferroni")) 

```

