---
title: "030- Morphometrics tests for significance and correlation"
output:
  html_document: 
    toc: true
    toc_float:
        collapsed: false
        smooth_scroll: true
    fig_width: 20
  pdf_document: 
    fig_width: 20
    fig_height: 9
---

# Directory and doc rules

```{r, setup, eval=TRUE, include=TRUE}

knitr::opts_chunk$set(
  echo = TRUE,         # Display code chunks
  eval = TRUE,         # Evaluate code chunks
  warning = FALSE,     # Hide warnings
  message = FALSE,     # Hide messages
  fig.width = 20,       # Set plot width in inches
  fig.height = 9,      # Set plot height in inches
  fig.align = "center" # Align plots to the center
)

```

# Load packages

```{r}
library(tinytex)
library(tidyr)
library(tidyverse)
library(vegan)

```

# Load data

```{r}

#Port Angeles Yacht Club has been removed due to being an abnormally high outlier in comparison to all other locations.
#getwd()
mdata<- read.csv("/Users/cmantegna/Documents/WDFWmussels/data/morphometricdata.csv")

```

# Check data

```{r}
summary(mdata)
```

# Shapiro-Wilkes 
```{r}

#test for normality. 
#Condition factor (cf) is not normally distributed. 
#Average shell thickness (at) is normally distributed.
# *All analytes were determined not normally distributed in 010-p450.Rmd* 

shapiro.test(mdata$cf)
shapiro.test(mdata$at)

```

# Significant Differences

## cf- Kruskal-Wallis (non-parametric data)

```{r}

#test for significant differences - cf

# Change to character for the kw test AFTER keeping as numeric for the correlation tests - if necessary
#apdata$PAHgroup <- as.character(apdata$PAHgroup)
#apdata$PAHgroup2 <- as.character(apdata$PAHgroup2)
#apdata$PAHgroup3 <- as.character(apdata$PAHgroup3)

kruskal.test(cf ~ site_name, data = mdata)
kruskal.test(cf ~ reporting_area, data = mdata)
kruskal.test(cf ~ PAHgroup, data = mdata)
kruskal.test(cf ~ PAHgroup2, data = mdata)
kruskal.test(cf ~ PAHgroup3, data = mdata)

```

##cf- Kruskal-Wallac Multiple Comparisons (post hoc)
Reporting Areas Are:\
6 - East Juan de Fuca Strait\
7 - San Juan Islands\
8.1 - Deception Pass, Hope Island, and Skagit Bay\
8.2 - Port Susan and Port Gardner\
9 - Admiralty Inlet\
10 - Seattle-Bremerton\
11 - Tacoma-Vashon\
12 - Hood Canal\
13 - South Puget Sound

```{r}
library(pgirmess)

mdata$reporting_area <- as.character(mdata$reporting_area)

# no significant differences across site.
# no significant differences across reporting area

mc_site<- as.data.frame(kruskalmc(cf ~ site_name, data = mdata, method = "bonferroni"))
mc_reporting<- as.data.frame(kruskalmc(cf ~ reporting_area, data = mdata, method = "bonferroni")) 

head(mc_site)
head(mc_reporting)

```

## at- ANOVA (parametric data)
```{r}

#test for significant differences - at
mdata$reporting_area <- as.character(mdata$reporting_area)
mdata$PAHgroup3 <- as.character(mdata$PAHgroup3)

anova_site <- aov(at ~ site_name, data = mdata)
summary(anova_site)

anova_ra <- aov(at ~ reporting_area, data = mdata)
summary(anova_ra)

anova_group <- aov(at ~ PAHgroup, data = mdata)
summary(anova_group)

anova_group2 <- aov(at ~ PAHgroup2, data = mdata)
summary(anova_group2)

anova_group3 <- aov(at ~ PAHgroup3, data = mdata)
summary(anova_group3)

```

## at- TukeyHSD (post hoc)
```{r}

library(broom)
library(readr)

mdata$reporting_area <- as.character(mdata$reporting_area)
mdata$PAHgroup3 <- as.character(mdata$PAHgroup3)

#significant differences between 112 pairwise comparisons. Table written to GH repo.
tukey_site<- TukeyHSD(anova_site)
ttable_site<- tidy(tukey_site)
sigttable_site <- ttable_site %>% filter(adj.p.value < 0.05)
write.csv(sigttable_site, "/Users/cmantegna/Documents/WDFWmussels/output/tables/SignificantThicknessSite.csv", row.names = FALSE)

# significant  differences between reporting area comparisons: 11-10, 12-11, 6-11, 7-11, 8.1-11, 13-12, 6-13. Table written to GH repo.
tukey_ra<- TukeyHSD(anova_ra)
ttable_ra<- tidy(tukey_ra)
sigttable_ra <- ttable_ra %>% filter(adj.p.value < 0.05)
write.csv(sigttable_ra, "/Users/cmantegna/Documents/WDFWmussels/output/tables/SignificantThicknessRA.csv", row.names = FALSE)

# significant  differences between Low(1) and Mid(2) as well as Low(1) and Very High(4). Table written to GH repo.
tukey_group3<- TukeyHSD(anova_group3)
ttable_group3<- tidy(tukey_group3)
sigttable_group3 <- ttable_group3 %>% filter(adj.p.value < 0.05)
write.csv(sigttable_group3, "/Users/cmantegna/Documents/WDFWmussels/output/tables/SignificantThicknessGROUP3.csv", row.names = FALSE)

```

# Correlations

##cf- PAHgroup, PAHgroup2 and PAHgroup3
1= Low\
2= Mid\
3= High\
4= Very High\
PAHgroup= broken into 3rds by quantile in chunk 55-59in 010-p450.rmd\
PAHgroup2= broken into quarters manually by vibes\
PAHgroup3= broken into quarters by quartiles listed in data summary in chunk 55-59 in 010-p450.rmd
```{r}

mdata$PAHgroup <- as.numeric(mdata$PAHgroup)
mdata$PAHgroup2 <- as.numeric(mdata$PAHgroup2)
mdata$PAHgroup3 <- as.numeric(mdata$PAHgroup3)

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$PAHgroup, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$PAHgroup2, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$PAHgroup3, method = "pearson")
print(correlation_result)
```

## cf- sumPAH, lmwPAH, hmwPAH and PAH16
```{r}

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$sumPAH, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$lmwPAH, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$hmwPAH, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$PAH16, method = "pearson")
print(correlation_result)

```

## cf- sumPCB
```{r}

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$sumPCB, method = "pearson")
print(correlation_result)

```

## cf- mercury, arsenic, cadmium, copper, lead, zinc
```{r}

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$mercury, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$arsenic, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$cadmium, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$copper, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$lead, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$cf, mdata$zinc, method = "pearson")
print(correlation_result)

```

#Correlations

## at- PAHgroup, PAHgroup2 and PAHgroup3

1= Low\
2= Mid\
3= High\
4= Very High\
PAHgroup= broken into 3rds by quantile in chunk 55-59in 010-p450.rmd\
PAHgroup2= broken into quarters manually by vibes\
PAHgroup3= broken into quarters by quartiles listed in data summary in chunk 55-59 in 010-p450.rmd
```{r}

mdata$PAHgroup <- as.numeric(mdata$PAHgroup)
mdata$PAHgroup2 <- as.numeric(mdata$PAHgroup2)
mdata$PAHgroup3 <- as.numeric(mdata$PAHgroup3)

# no correlation
correlation_result <- cor.test(mdata$at, mdata$PAHgroup, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$at, mdata$PAHgroup2, method = "pearson")
print(correlation_result)

# correlation= 0.1205069 with a p-value= 0.03511 indicates a weak positive correlation.
correlation_result <- cor.test(mdata$at, mdata$PAHgroup3, method = "pearson")
print(correlation_result)
```

## at- sumPAH, lmwPAH, hmwPAH and PAH16
```{r}

# correlation= 0.1459292 with a p-value= 0.01059 indicates a weak positive correlation.
correlation_result <- cor.test(mdata$at, mdata$sumPAH, method = "pearson")
print(correlation_result)

# correlation= 0.1698226 with a p-value= 0.002881 indicates a weak positive correlation.
correlation_result <- cor.test(mdata$at, mdata$lmwPAH, method = "pearson")
print(correlation_result)

# correlation= 0.1306227 with a p-value= 0.02229 indicates a weak positive correlation.
correlation_result <- cor.test(mdata$at, mdata$hmwPAH, method = "pearson")
print(correlation_result)

# correlation= 0.1457735 with a p-value= 0.01067 indicates a weak positive correlation.
correlation_result <- cor.test(mdata$at, mdata$PAH16, method = "pearson")
print(correlation_result)

```

## at- sumPCB
```{r}

# no correlation
correlation_result <- cor.test(mdata$at, mdata$sumPCB, method = "pearson")
print(correlation_result)
```

## at- mercury, arsenic, cadmium, copper, lead, zinc
```{r}

# no correlation
correlation_result <- cor.test(mdata$at, mdata$mercury, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$at, mdata$arsenic, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$at, mdata$cadmium, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$at, mdata$copper, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$at, mdata$lead, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(mdata$at, mdata$zinc, method = "pearson")
print(correlation_result)

```