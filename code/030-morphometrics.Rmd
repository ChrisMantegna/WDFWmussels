---
title: "030- Morphometrics tests for significance and correlation"
output:
  pdf_document: 
    fig_width: 20
    fig_height: 9
  html_document: 
    toc: true
    toc_float:
        collapsed: false
        smooth_scroll: true
    fig_width: 20
---

# Directory and doc rules

```{r, setup, eval=TRUE, include=TRUE}

knitr::opts_chunk$set(
  echo = TRUE,         # Display code chunks
  eval = TRUE,         # Evaluate code chunks
  warning = FALSE,     # Hide warnings
  message = FALSE,     # Hide messages
  fig.width = 20,       # Set plot width in inches
  fig.height = 9,      # Set plot height in inches
  fig.align = "center" # Align plots to the center
)

```

# Load packages

```{r}
library(tinytex)
library(tidyr)
library(tidyverse)
library(vegan)

```

# Load data

```{r}

#Port Angeles Yacht Club has been removed due to being an abnormally high outlier in comparison to all other locations.
#getwd()

data<- read.csv("/Users/cmantegna/Documents/WDFWmussels/data/morphdata.csv")
indiv<- read.csv("/Users/cmantegna/Documents/WDFWmussels/data/avgMORPH_analytes.csv")
summed<- read.csv("/Users/cmantegna/Documents/WDFWmussels/data/avgMORPH_analytes2.csv")
metal<- read.csv("/Users/cmantegna/Documents/WDFWmussels/data/avgMORPH_metals.csv")
```

# Check data

```{r}
summary(mdata)
```

# Shapiro-Wilkes 
```{r}

#test for normality. 
#Condition factor (cf) is not normally distributed. 
#Average shell thickness (at) is normally distributed.

shapiro.test(data$cf)
shapiro.test(data$at)

```

# Significant Differences
## cf- reporting area & site, PAH group 3 and 4 - Kruskal-Wallis (non-parametric data)
Reporting Areas Are:\
6 - East Juan de Fuca Strait\
7 - San Juan Islands\
8.1 - Deception Pass, Hope Island, and Skagit Bay\
8.2 - Port Susan and Port Gardner\
9 - Admiralty Inlet\
10 - Seattle-Bremerton\
11 - Tacoma-Vashon\
12 - Hood Canal\
13 - South Puget Sound

```{r}

#test for significant differences - cf

#apdata$PAHgroup3 <- as.character(apdata$PAHgroup3)
#apdata$PAHgroup4 <- as.character(apdata$PAHgroup4)


kruskal.test(cf ~ site_name, data = data)
kruskal.test(cf ~ reporting_area, data = data)
kruskal.test(cf ~ PAHgroup3, data = data)
kruskal.test(cf ~ PAHgroup4, data = data)

```

## cf- PAH groups 5-8 - Kruskal-Wallis (non-parametric data)
```{r}

#apdata$PAHgroup6 <- as.character(apdata$PAHgroup6)
#apdata$PAHgroup8 <- as.character(apdata$PAHgroup8)

kruskal.test(cf ~ PAHgroup6, data = data)
kruskal.test(cf ~ PAHgroup8, data = data)

```

##cf- Kruskal-Wallac Multiple Comparisons (post hoc)
### no significant differences across site, reporting area 

```{r}
library(pgirmess)

data$reporting_area <- as.character(data$reporting_area)

# no significant differences across site.
# no significant differences across reporting area
# no signifciant differences across PAHgroup8

mc_site<- as.data.frame(kruskalmc(cf ~ site_name, data = data, method = "bonferroni"))
mc_reporting<- as.data.frame(kruskalmc(cf ~ reporting_area, data = data, method = "bonferroni")) 

head(mc_site)
head(mc_reporting)


```

## at- ANOVA (parametric data)
```{r}

#test for significant differences - at
data$reporting_area <- as.character(data$reporting_area)
data$PAHgroup3 <- as.character(data$PAHgroup3)
data$PAHgroup4 <- as.character(data$PAHgroup4)


anova_site <- aov(at ~ site_name, data = data)
summary(anova_site)

anova_ra <- aov(at ~ reporting_area, data = data)
summary(anova_ra)

anova_group3 <- aov(at ~ PAHgroup3, data = data)
summary(anova_group3)

anova_group4 <- aov(at ~ PAHgroup4, data = data)
summary(anova_group4)

```

## PAH group 6-8
```{r}

data$PAHgroup6 <- as.character(data$PAHgroup6)
data$PAHgroup8 <- as.character(data$PAHgroup8)

anova_group6 <- aov(at ~ PAHgroup6, data = data)
summary(anova_group6)

anova_group8 <- aov(at ~ PAHgroup8, data = data)
summary(anova_group8)
```


## at- TukeyHSD (post hoc)
### Site: significant differences between 112 pairwise comparisons.
### Reporting Areas: significant differences between 7 pairwise comparisons.
### PAH Group 4: significant differences between 2 pairwise comparisons.
### PAH Group 6: significant differences between 4 pairwise comparisons.
### PAH Group 8: significant differences between 3 pairwise comparisons.
```{r}

library(broom)
library(readr)

#site
tukey_site<- TukeyHSD(anova_site)
ttable_site<- tidy(tukey_site)
sigttable_site <- ttable_site %>% filter(adj.p.value < 0.05)
write.csv(sigttable_site, "/Users/cmantegna/Documents/WDFWmussels/output/tables/SignificantThicknessSite.csv", row.names = FALSE)

#reporting area 
tukey_ra<- TukeyHSD(anova_ra)
ttable_ra<- tidy(tukey_ra)
sigttable_ra <- ttable_ra %>% filter(adj.p.value < 0.05)
write.csv(sigttable_ra, "/Users/cmantegna/Documents/WDFWmussels/output/tables/SignificantThicknessRA.csv", row.names = FALSE)

#PAH Group 4
tukey_group4<- TukeyHSD(anova_group4)
ttable_group4<- tidy(tukey_group4)
sigttable_group4 <- ttable_group4 %>% filter(adj.p.value < 0.05)
write.csv(sigttable_group4, "/Users/cmantegna/Documents/WDFWmussels/output/tables/SignificantThicknessGROUP4.csv", row.names = FALSE)

#PAH Group 6
tukey_group6<- TukeyHSD(anova_group6)
ttable_group6<- tidy(tukey_group6)
sigttable_group6 <- ttable_group6 %>% filter(adj.p.value < 0.05)
write.csv(sigttable_group6, "/Users/cmantegna/Documents/WDFWmussels/output/tables/SignificantThicknessGROUP6.csv", row.names = FALSE)

#PAH Group 8
tukey_group8<- TukeyHSD(anova_group8)
ttable_group8<- tidy(tukey_group8)
sigttable_group8 <- ttable_group8 %>% filter(adj.p.value < 0.05)
write.csv(sigttable_group8, "/Users/cmantegna/Documents/WDFWmussels/output/tables/SignificantThicknessGROUP8.csv", row.names = FALSE)
```


# Correlations

## cf- sumPAH, lmwPAH, hmwPAH and PAH16
### No correlations
```{r}

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$sumPAH, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$lmwPAH, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$hmwPAH, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$sum16PAH, method = "pearson")
print(correlation_result)

```

## cf- sumPCBs and sum42PAH
### No correlation
```{r}

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$sumPCB, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$sum42PAH, method = "pearson")
print(correlation_result)

```

## cf- other summed analytes
### No correlation
```{r}

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$um40CB, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$sumBDE, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$sumCHLD, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$sumDDT, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$sumHCH, method = "pearson")
print(correlation_result)

```

## cf- mercury, arsenic, cadmium, copper, lead, zinc
### No correlation
```{r}

# no correlation
correlation_result <- cor.test(metal$avg_cf, metal$mercuryTotal, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(metal$avg_cf, metal$arsenic, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(metal$avg_cf, metal$cadmium, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(metal$avg_cf, metal$copper, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(metal$avg_cf, metal$lead, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(metal$avg_cf, metal$Zinc, method = "pearson")
print(correlation_result)

```



#Correlations
## at- sumPAH, lmwPAH, hmwPAH and PAH16
### No correlations
```{r}

# no correlation
correlation_result <- cor.test(summed$avg_at, summed$sumPAH, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_at, summed$lmwPAH, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_at, summed$hmwPAH, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_at, summed$sum16PAH, method = "pearson")
print(correlation_result)

```

## at- sumPCBs and sum42PAH
### No correlation
```{r}

# no correlation
correlation_result <- cor.test(summed$avg_at, summed$sumPCB, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_cf, summed$sum42PAH, method = "pearson")
print(correlation_result)

```

## at- other summed analytes
### No correlation
```{r}

# no correlation
correlation_result <- cor.test(summed$avg_at, summed$um40CB, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_at, summed$sumBDE, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_at, summed$sumCHLD, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_at, summed$sumDDT, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(summed$avg_at, summed$sumHCH, method = "pearson")
print(correlation_result)

```

## at- mercury, arsenic, cadmium, copper, lead, zinc
### No correlation
```{r}

# no correlation
correlation_result <- cor.test(metal$avg_at, metal$mercuryTotal, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(metal$avg_at, metal$arsenic, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(metal$avg_at, metal$cadmium, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(metal$avg_at, metal$copper, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(metal$avg_at, metal$lead, method = "pearson")
print(correlation_result)

# no correlation
correlation_result <- cor.test(metal$avg_at, metal$Zinc, method = "pearson")
print(correlation_result)

```








