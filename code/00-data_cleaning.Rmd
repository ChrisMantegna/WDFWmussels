---
title: "00- Data Cleaning"
output:
  pdf_document: 
    fig_width: 20
    fig_height: 9
  html_document: 
    toc: true
    toc_float:
        collapsed: false
        smooth_scroll: true
    fig_width: 20
---

# Directory and doc rules

```{r, setup, eval=TRUE, include=TRUE}

knitr::opts_chunk$set(
  root.dir = here::here(),
  echo = TRUE,         # Display code chunks
  eval = TRUE,         # Evaluate code chunks
  warning = FALSE,     # Hide warnings
  message = FALSE,     # Hide messages
  #fig.width = 15,       # Set plot width in inches
  #fig.height = 9,      # Set plot height in inches
  fig.align = "center" # Align plots to the center
)

```

# Load Data

```{r, load data}

# double check where you are
# *NOTE* set to root (WDFWmussels) and not a directory within - check into why that is happening in the knitr block
getwd()

# load data
data<- read.csv("../data/all_samples_with_imputations_and_identifiers.csv")


```

---
# Data Format
P450 & SOD Activity (Unit / mg"^"-1"~"protein)
Shell Thickness - mm
Weight - g
CI - unitless
---

# Data Review

```{r review data}

# take a look at your df
str(data) # df setup review

# str() tells us that our df has 312 rows and 9 columns and that our sample_id and site number are being treated as integers; this might be a problem in analyses and plotting.

summary(data) # df stats for each column

# summary() tells us a few useful things: (1) our lat/ long bounds which we'll need for mapping, (2) we have NA values in p450 and condition_factor that need to be investigated before moving forward.

```

# Dealing with NA's

```{r }

# Fixing NAs or errant values

# replace 0's with NA, we can ignore them in further analyses
data$p450[data$p450 <= 0] <- NA

# replace any values below LOQ with imputed LOQ (.5 x LOD), LOD= 0.05
data$sod[data$sod <= 0] <- 0.0025

# check
summary(data)

```

# Column Names - Don't Need to Run after 3.7.25

```{r}

# i also noticed that all of my column names aren't lowercase, so let's fix that to prevent unnecessary mistakes
#colnames(data) <- tolower(colnames(data))

```

# don't forget to write out this table, i keep skipping that in this file.
```{r}

#save df
write.csv(data, "/Users/cmantegna/Documents/Github/WDFWmussels/data/cleaned_all_samples.csv", row.names = FALSE)

```

# Create averaged df for site level analysis
```{r}

library(dplyr)

averaged_data <- data %>%
  group_by(site_number, latitude, longitude, site_name) %>%  
  summarise(
    p450 = mean(p450, na.rm = TRUE),  
    sod = mean(sod, na.rm = TRUE),
    shell = mean(shell, na.rm = TRUE),
    ci1 = mean(ci1, na.rm = TRUE),
    ci2 = mean(ci2, na.rm = TRUE),
    ci3 = mean(ci3, na.rm = TRUE),
    iweight = mean(weight_initial_g, na.rm = TRUE),
    fweight = mean(weight_final_g, na.rm = TRUE),
    cweight = mean(weight_change_g, na.rm = TRUE),
    length = mean(length_mm, na.rm = TRUE),
    width = mean(width_mm, na.rm = TRUE),
    height = mean(height_mm, na.rm = TRUE),
  ) %>%
  ungroup()  # Remove grouping for the new dataframe

# save df
write.csv(averaged_data, "/Users/cmantegna/Documents/Github/WDFWmussels/data/cleaned_avg_sites.csv", row.names = FALSE)

```

